<button mat-fab routerLink="/community/post">
  <mat-icon>
    edit
  </mat-icon>
</button>
<mist-masonry [datasets]="datasets" [columns]="screen.currentScreen" [tpl]="tpl"></mist-masonry>
<mat-progress-spinner mode="indeterminate" diameter=32 *ngIf="isLoading" color="warn"></mat-progress-spinner>
<ng-template #tpl let-item>
  <div class="container mat-elevation-z6">
    <div class="info">
      <a [routerLink]="['/user', item.owner.uid, 'community']"><div class="avatar" [style.background-image]="'url('+(item.owner.avatar || 'assets/da.jpg') +')'"></div></a>
      <span>{{item.owner.nickName}}</span>
      <span class="spacer"></span>
      <span>{{item.date | moment}}</span>
    </div>
    <div class="body" *ngIf="item.cont">
      <mat-divider></mat-divider>
      <div>{{item.full ? item.cont : setCont(item.cont)}}</div>
      <span *ngIf="setCont(item.cont)!=item.cont" (click)="item.full=!item.full">{{item.full ? '折叠' : '...展开'}}</span>
    </div>
    <div class="gallery" [style.grid-template-columns]="item.pics.length===1 ? '1fr' : item.pics.length > 4 ? '1fr 1fr 1fr' : '1fr 1fr'"
      *ngIf="item.pics">
      <img [src]="pic + '_thb.jpeg'" *ngFor="let pic of item.pics;let i=index" (click)="openDetail(detail, i, item)">
    </div>
  </div>
</ng-template>

<ng-template #detail let-data>
  <img [src]="data.ref.pics[data.index]" (click)="dialogRef.close()" class="viewimg" mistLoader>
  <button mat-icon-button style="left: 20px;" (click)="data.index = data.index-1" [disabled]="data.index===0">
    <mat-icon>
      chevron_left
    </mat-icon>
  </button>
  <button mat-icon-button style="right: 20px;" (click)="data.index = data.index+1" [disabled]="data.index===data.ref.pics.length-1">
    <mat-icon>
      chevron_right
    </mat-icon>
  </button>
</ng-template>
